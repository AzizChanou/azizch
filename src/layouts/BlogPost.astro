---
import type { CollectionEntry } from "astro:content";
import Default from "./Default.astro";
import TableOfContents from "../components/TableOfContents.astro";
import { Icon } from "astro-icon/components";
import type { MarkdownHeading } from "astro";
import { siteConfig } from "@/consts";
import GiscusLoader from "@/components/GiscusLoader.astro";
import { generateImageUrl } from "@/utils";

type Props = CollectionEntry<"blog">["data"] & {
  headings: MarkdownHeading[];
  remarkPluginFrontmatter: Record<string, string>;
};

const { title, description, headings, heroImage } = Astro.props;
const { href } = Astro.url;
---

<script>
  const copy = document.getElementById("copy");

  copy?.addEventListener("click", function () {
    copy.dataset.link && navigator.clipboard.writeText(copy.dataset.link);
  });
</script>

<Default title={title} description={description} image={generateImageUrl(heroImage)}>
  <div>
    <article>
      <div
        class="flex flex-col lg:flex-row-reverse justify-between gap-8 relative"
      >
        <div class="md:w-1/4 relative">
          <div class="sticky top-0 md:top-28 hidden lg:block">
            <TableOfContents headings={headings} />
          </div>
        </div>
        <div class="grow w-full md:max-w-[75ch]">
          <div
            class="prose prose-neutral prose-lg md:prose-xl dark:prose-invert prose-img:rounded-xl prose-figure:text-center prose-img:mx-auto font-normal"
          >
            <slot />
          </div>
        </div>
      </div>
    </article>
  </div>
  <div class="py-4 flex justify-center">
    <div class="flex flex-col items-center space-y-4">
      <h4 class="text-2xl">Share the article</h4>
      <ul class="flex space-x-4 text-2xl">
        <li class="hover:scale-110 duration-300">
          <button id="copy" aria-label="Copier le lien" data-link={href}>
            <Icon name="mdi:content-copy" />
          </button>
        </li>
        <li class="hover:scale-110 duration-300">
          <a
            rel="noopener"
            target="_blank"
            aria-label="Partager sur LinkedIn"
            class="hover:scale-125 hover:text-blue-300 duration-300"
            href={`https://www.linkedin.com/sharing/share-offsite/?url=${href}`}
          >
            <Icon name="mdi:linkedin" />
          </a>
        </li>
        <li class="hover:scale-110 duration-300">
          <a
            rel="noopener"
            target="_blank"
            aria-label="Partager sur LinkedIn"
            class="hover:scale-125 hover:text-blue-400 duration-300"
            href={`https://twitter.com/intent/tweet?url=${href}&text=${description}`}
          >
            <Icon name="mdi:twitter" />
          </a>
        </li>
        <li class="hover:scale-110 duration-300">
          <a
            rel="noopener"
            target="_blank"
            aria-label="Partager sur LinkedIn"
            class="hover:scale-125 hover:text-blue-500 duration-300"
            href={`https://www.facebook.com/sharer/sharer.php?u=${href}`}
          >
            <Icon name="mdi:facebook" />
          </a>
        </li>
        <li class="hover:scale-110 duration-300">
          <a
            rel="noopener"
            target="_blank"
            aria-label="Partager sur LinkedIn"
            class="hover:scale-125 hover:text-green-500 duration-300"
            href={`https://wa.me/?text=${href}`}
          >
            <Icon name="mdi:whatsapp" />
          </a>
        </li>
      </ul>
    </div>
  </div>
  {
    siteConfig.giscus && (
      <section>
        <div class="flex gap-3 max items-center my-4">
          <hr class="flex-1 bg-slate-100 h-[1px] border-none" />
          <span class="shrink-0 whitespace-nowrap text-3xl">Comments</span>
          <hr class="flex-1 bg-slate-100 h-[1px] border-none" />
        </div>
        <div>
          <GiscusLoader />
        </div>
      </section>
    )
  }
</Default>
